openapi: 3.0.0
info:
  title: Plan API
  version: 1.0.0
  description: Rise API Docs

paths:
  /plans:
    post:
      summary: Create a new plan
      tags:
        - Plans
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreatePlanDTO"
      responses:
        "200":
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Plan"
        "400":
          description: Invalid input
        "401":
          description: Unauthorized
      security:
        - headlessAuth: []

    get:
      summary: Admin/User List plans
      tags:
        - Plans
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum: [active, inactive, matured]
        - in: query
          name: offset
          schema:
            type: integer
        - in: query
          name: limit
          schema:
            type: integer
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaginatedPlanResult"
        "422":
          description: Unprocessable entity
        "500":
          description: Internal server error

  /plans/{id}:
    get:
      summary: Fetch a specific plan
      tags:
        - Plans
      parameters:
        - $ref: "#/components/parameters/PlanId"
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Plan"
        "403":
          description: Forbidden
        "404":
          description: Not found
        "500":
          description: Internal server error

    patch:
      summary: Edit a plan
      tags:
        - Plans
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
        - in: header
          name: Content-Type
          schema:
            type: string
            enum: [multipart/form-data, application/json]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EditPlanDTO"
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Plan"
        "403":
          description: Forbidden
        "404":
          description: Not found
        "500":
          description: Internal server error

    delete:
      summary: Delete a plan
      tags:
        - Plans
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Successful response
        "403":
          description: Forbidden
        "404":
          description: Not found
        "422":
          description: Unprocessable entity
        "500":
          description: Internal server error

  /plans/{id}/history:
    get:
      summary: Fetch plan history
      tags:
        - Plans
      parameters:
        - $ref: "#/components/parameters/PlanId"
        - $ref: "#/components/parameters/offsetParam"
        - $ref: "#/components/parameters/limitParam"
        - $ref: "#/components/parameters/orderParam"
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaginatedMaturityLogResult"
        "403":
          description: Forbidden
        "404":
          description: Not found
        "500":
          description: Internal server error

  /plans/{id}/returns:
    get:
      summary: Fetch plan returns
      tags:
        - Plans
      parameters:
        - $ref: "#/components/parameters/PlanId"
        - $ref: "#/components/parameters/offsetParam"
        - $ref: "#/components/parameters/limitParam"
        - $ref: "#/components/parameters/orderParam"
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaginatedPlanReturnsResult"
        "403":
          description: Forbidden
        "404":
          description: Not found
        "500":
          description: Internal server error

  /plans/{id}/performances:
    get:
      summary: Fetch plan performances
      tags:
        - Plans
      parameters:
        - $ref: "#/components/parameters/PlanId"
        - $ref: "#/components/parameters/offsetParam"
        - $ref: "#/components/parameters/limitParam"
        - $ref: "#/components/parameters/orderParam"
        - in: query
          name: type
          required: true
          schema:
            type: string
            enum: [daily, weekly, monthly, yearly]
            default: daily
          description: The type of performance data to retrieve.
        - in: query
          name: paginate
          description: Whether or not the items should be paginated.
          schema:
            type: boolean
            default: true

      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/PaginatedPlanPerformancesResult"
                  - type: array
                    items:
                      $ref: "#/components/schemas/PlanPerformance"
                description: The response may either be paginated or a full list of performances, depending on the `paginate` query parameter.
        
              examples:
                paginated:
                  summary: Paginated response example
                  value:
                    items:
                      - plan_id: "550e8400-e29b-41d4-a716-446655440000"
                        type: "daily"
                        description: "Performance for January 1, 2024"
                        holding_period_return: 1.2
                        geometric_return: 1.1
                        twr: 1.15
                        date: "2024-01-01T00:00:00Z"
                        starting_balance: 10000
                        closing_balance: 10120
                        deposits: 200
                        withdrawals: 80
                        cashflow: 120
                        returns: 120
                      - plan_id: "550e8400-e29b-41d4-a716-446655440001"
                        type: "daily"
                        description: "Performance for January 2, 2024"
                        holding_period_return: 1.5
                        geometric_return: 1.3
                        twr: 1.25
                        date: "2024-01-02T00:00:00Z"
                        starting_balance: 10120
                        closing_balance: 10290
                        deposits: 200
                        withdrawals: 30
                        cashflow: 170
                        returns: 170
                    tem_count: 2
                    offset: 0
                nonPaginated:
                  summary: Non-paginated response example
                  value:
                    - plan_id: "550e8400-e29b-41d4-a716-446655440000"
                      type: "daily"
                      description: "Performance for January 1, 2024"
                      holding_period_return: 1.2
                      geometric_return: 1.1
                      twr: 1.15
                      date: "2024-01-01T00:00:00Z"
                      starting_balance: 10000
                      closing_balance: 10120
                      deposits: 200
                      withdrawals: 80
                      cashflow: 120
                      returns: 120
                    - plan_id: "550e8400-e29b-41d4-a716-446655440001"
                      type: "daily"
                      description: "Performance for January 2, 2024"
                      holding_period_return: 1.5
                      geometric_return: 1.3
                      twr: 1.25
                      date: "2024-01-02T00:00:00Z"
                      starting_balance: 10120
                      closing_balance: 10290
                      deposits: 200
                      withdrawals: 30
                      cashflow: 170
                      returns: 170
        "403":
          description: Forbidden
        "404":
          description: Not found
        "500":
          description: Internal server error

  /plans/{id}/config:
    post:
      summary: Set plan configuration
      tags:
        - Plans
      parameters:
        - $ref: "#/components/parameters/PlanId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ConfigDTO"
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Plan"
        "400":
          description: Bad request
        "403":
          description: Forbidden
        "404":
          description: Not found
        "422":
          description: Unprocessable entity
        "500":
          description: Internal server error

  /plans/{id}/toggle-reinvest:
    post:
      summary: Toggle plan reinvestment
      tags:
        - Plans
      parameters:
        - $ref: "#/components/parameters/PlanId"
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Plan"
        "403":
          description: Forbidden
        "404":
          description: Not found
        "500":
          description: Internal server error

  /plans/{id}/reinvest:
    post:
      summary: Reinvest matured plan
      tags:
        - Plans
      parameters:
        - $ref: "#/components/parameters/PlanId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ReinvestDTO"
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Plan"
        "403":
          description: Forbidden
        "404":
          description: Not found
        "500":
          description: Internal server error

  /config:
    get:
      summary: Get custom plans from oracle
      tags:
        - Plans
      parameters:
        - in: query
          name: entity
          schema:
            type: string
            default: custom_plan
        - in: query
          name: filter_key
          schema:
            type: string
            enum: [category, is_live, pure]
            example: category
        - in: query
          name: filter_value
          schema:
            type: string
            enum: [goal, pure]
            example: goal
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CustomPlans"
        "403":
          description: Forbidden
        "404":
          description: Not found
        "500":
          description: Internal server error

  /plans/stats:
    get:
      summary: Fetch users portfolio stats
      tags:
        - Plans
      parameters:
        - in: query
          name: owner_id
          schema:
            type: string
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AUMStats"
        "403":
          description: Forbidden
        "404":
          description: Not found
        "500":
          description: Internal server error

  /gifts:
    post:
      summary: Create a new gift
      tags:
        - Gifts
      parameters:
        - name: x-rise-authorization-token
          in: header
          description: Authorization token for 2fa actions
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SendGiftDTO"
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Gift"
        "422":
          description: Unprocessable entity
        "500":
          description: Internal server error

  /gifts/{giftId}:
    get:
      summary: Fetch a specific gift
      tags:
        - Gifts
      parameters:
        - name: giftId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Gift"
        "422":
          description: Unprocessable entity
        "500":
          description: Internal server error

  /gifts/{giftId}/{action}:
    post:
      summary: Accept or decline a gift
      tags:
        - Gifts
      parameters:
        - in: path
          name: giftId
          required: true
          schema:
            type: string
            format: uuid
        - in: path
          name: action
          required: true
          schema:
            type: string
            enum: [accept, decline]
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Gift"
        "404":
          description: Gift not found
        "422":
          description: Unprocessable entity
        "500":
          description: Internal server error

  /gifts/{id}/cancel:
    patch:
      summary: Cancel a gift
      tags:
        - Gifts
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Gift"
        "403":
          description: Forbidden
        "404":
          description: Gift not found
        "422":
          description: Unprocessable entity
        "500":
          description: Internal server error

  /proxy/users/authenticate-2fa-action:
    post:
      summary: Authenticate 2FA action
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TwoFAActionDTO"
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TwoFAAction"
        "422":
          description: Unprocessable entity
        "500":
          description: Internal server error

  /proxy/users/auto-invest-config:
    post:
      summary: Set auto-invest configuration for a user
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserAutoInvestConfigDTO"
      responses:
        "200":
          description: Successful response
        "422":
          description: Unprocessable entity
        "500":
          description: Internal server error

  /plans/transaction-requests:
    post:
      summary: Fund or withdraw from a plan
      tags:
        - Transaction Requests
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PlanTransactionDTO"
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/Plan"
        "403":
          description: Forbidden
        "404":
          description: Plan not found
        "422":
          description: Unprocessable entity

    get:
      summary: Fetch plan transaction requests
      tags:
        - Transaction Requests
      parameters:
        - in: query
          name: plan_id
          required: true
          schema:
            type: string
        - in: query
          name: owner_id
          schema:
            type: string
        - in: query
          name: request_type
          schema:
            type: string
            enum: ["funding", "withdrawal"]
        - in: query
          name: order
          schema:
            type: string
            enum: ["desc", "asc"]
        - in: query
          name: start_date
          schema:
            type: string
        - in: query
          name: end_date
          schema:
            type: string
        - in: query
          name: page
          schema:
            type: integer
        - in: query
          name: limit
          schema:
            type: integer

      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaginatedTransactionRequestResult"
        "422":
          description: Unprocessable entity
        "500":
          description: Internal server error

  /external-wallets:
    post:
      summary: Create Direct Debit External
      tags:
        - Direct Debit
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DirectDebitDTO"
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ExternalWallet"
        "422":
          description: Unprocessable entity
        "500":
          description: Internal server error
    get:
      summary: Create Direct Debit External
      tags:
        - Direct Debit
      parameters:
        - in: query
          name: owner_id
          required: false
          schema:
            type: string
        - in: query
          name: wallet_type
          required: false
          schema:
            type: string
        - in: query
          name: status
          required: false
          schema:
            type: string
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ExternalWallet"
        "422":
          description: Unprocessable entity
        "500":
          description: Internal server error

  /external-wallets/{externalWalletId}/{action}:
    post:
      summary: Update the state of a direct debit external wallet
      tags:
        - Direct Debit
      parameters:
        - in: path
          name: externalWalletId
          required: true
          schema:
            type: string
            format: uuid
        - in: path
          name: action
          required: true
          schema:
            type: string
            enum: [disable, re-enable]
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ExternalWallet"
        "422":
          description: Unprocessable entity
        "500":
          description: Internal server error

  /transaction-requests:
    post:
      summary: Initiate funding via Direct Debit
      tags:
        - Direct Debit
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ExternalWalletTransactionRequestDTO"
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ExternalWalletTransactionRequestResponse"
        "422":
          description: Unprocessable entity
        "500":
          description: Internal server error

  /portfolios/{id}/assets:
    get:
      summary: Fetch assets under a portfolio
      tags:
        - Portfolios
      parameters:
        - $ref: "#/components/parameters/PortfolioId"
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Asset"
                description: A list of assets.
        "403":
          description: Forbidden
        "404":
          description: Not found
        "500":
          description: Internal server error
  
  /users:
    post:
    summary: User Sign Up
    tags:
      - Users
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/RegistrationDTO"
    responses:
      "200":
        description: Successful operation
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Users"
      "400":
        description: Invalid input

  /users/validate-signup:
    post:
      summary: Validate User Signup Information (email and phone number)
      tags:
        - Users
      requestBody:
        description: Validate signup data using the provided identity type and identifier.
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ValidateSignupDTO"
      responses:
        "200":
          description: Signup validated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  is_valid:
                    type: boolean
                    description: Indicates if the signup identifier is valid
                    example: true
        "400":
          description: Invalid input
    



components:
  parameters:
    offsetParam:
      in: query
      name: offset
      schema:
        type: integer
    limitParam:
      in: query
      name: limit
      schema:
        type: integer
    orderParam:
      in: query
      name: order
      schema:
        type: string
        enum: [asc, desc]
        default: asc

    PlanId:
      name: id
      in: path
      required: true
      description: The ID of the plan
      schema:
        type: string
        format: uuid

    PortfolioId:
      name: id
      in: path
      required: true
      description: The ID of the portfolio
      schema:
        type: string
        format: uuid

  schemas:
    CreatePlanDTO:
      type: object
      required:
        - plan_name
        - plan_type
        - owner_id
        - portfolio_config
        - duration
      properties:
        plan_name:
          type: string
        plan_type:
          $ref: "#/components/schemas/PlanType"
        owner_id:
          type: string
          format: uuid
        portfolio_config:
          $ref: "#/components/schemas/PortfolioConfig"
        cycle:
          type: number
          default: 1
        duration:
          type: number
        metadata:
          type: object
          properties:
            goal_amount:
              type: number
            created_by:
              type: string
            category:
              type: string
            type:
              type: string
            dividend_amount:
              type: number
            should_reinvest_dividends:
              type: boolean

    EditPlanDTO:
      type: object
      properties:
        plan_name:
          type: string
        picture:
          type: string
          format: uri
          nullable: true

    PaginatedPlanResult:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/Plan"
        item_count:
          type: integer
        offset:
          type: integer

    PaginatedTransactionRequestResult:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/TransactionRequest"
        item_count:
          type: integer
        offset:
          type: integer

    MaturityLog:
      type: object
      properties:
        plan_id:
          type: string
        owner_id:
          type: string
        matured_at:
          type: string
          format: date-time
        cycle:
          type: number
        capital:
          type: number
        total_returns:
          type: number
        available_returns:
          type: number
        total_funded:
          type: number
        total_withdrawn:
          type: number
        created_at:
          type: string
          format: date-time

    PlanReturn:
      type: object
      properties:
        plan_id:
          type: string
        description:
          type: string
        interest_date:
          type: string
          format: date-time
        amount:
          type: number
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    PlanPerformance:
      type: object
      properties:
        plan_id:
          type: string
        type:
          $ref: "#/components/schemas/PerformanceType"
        description:
          type: string
        holding_period_return:
          type: number
        geometric_return:
          type: number
        twr:
          type: number
        date:
          type: string
          format: date-time
        starting_balance:
          type: number
        closing_balance:
          type: number
        deposits:
          type: number
        withdrawals:
          type: number
        cashflow:
          type: number
        returns:
          type: number

    PaginatedMaturityLogResult:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/MaturityLog"
        item_count:
          type: number
        offset:
          type: integer

    PaginatedPlanReturnsResult:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/PlanReturn"
        item_count:
          type: number
        offset:
          type: integer

    PaginatedPlanPerformancesResult:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/PlanPerformance"
        item_count:
          type: number
        offset:
          type: integer

    ConfigDTO:
      type: object
      properties:
        type:
          $ref: "#/components/schemas/PlanConfigType"
        config:
          oneOf:
            - $ref: "#/components/schemas/AutoInvestConfigDTO"
            - $ref: "#/components/schemas/PortfolioConfig"
      required:
        - type
        - config

    PlanConfigType:
      type: string
      enum:
        - autofund
        - portfolio

    AutoInvestConfigDTO:
      type: object
      properties:
        auto_invest_enabled:
          type: boolean
        auto_invest_frequency:
          $ref: "#/components/schemas/AutoInvestFrequency"
        auto_invest_config:
          $ref: "#/components/schemas/AutoInvestConfig"

    AutoInvestConfig:
      type: object
      properties:
        month_day:
          type: integer
          format: int32
          minimum: 1
          maximum: 31
        week_day:
          type: integer
          format: int32
          minimum: 1
          maximum: 7
        hour:
          type: integer
          format: int32
          minimum: 0
          maximum: 23
        amount:
          type: number
          format: double

    PortfolioConfig:
      type: object
      description: >
        List of one or more UUID keys mapping to PortfolioConfigData objects.
      properties:
        a81bc81b-dead-4e5d-abff-90865d1e13b1:
          $ref: "#/components/schemas/PortfolioConfigData"
        b21dc81b-bcde-4e5d-bcda-90865d1e13b2:
          $ref: "#/components/schemas/PortfolioConfigData"

    PortfolioConfigData:
      type: object
      properties:
        percentage:
          type: number
          format: double
        asset_class:
          $ref: "#/components/schemas/AssetClass"

    AssetClass:
      type: string
      description: The class of asset in the portfolio
      example: stock

    PlanStatus:
      type: string
      enum:
        - active
        - inactive
        - matured

    AutoInvestFrequency:
      type: string
      enum:
        - daily
        - weekly
        - monthly

    PerformanceType:
      type: string
      enum:
        - daily
        - weekly
        - monthly
        - yearly

    PlanType:
      type: string
      enum:
        - Savings
        - Build Wealth
        - Rent
        - Wedding
        - Kids
        - Business
        - School
        - Fixed Income
        - Stocks
        - Real Estate
        - Home
        - Travel
        - Fixed Dividend Income

    Plan:
      type: object
      properties:
        id:
          type: string
        plan_name:
          type: string
        owner_id:
          type: string
        portfolio_config:
          $ref: "#/components/schemas/PortfolioConfig"
        status:
          $ref: "#/components/schemas/PlanStatus"
        duration:
          type: number
        cycle:
          type: number
        capital:
          type: number
        investment:
          type: number
        picture:
          type: string
          nullable: true
        reinvest:
          type: boolean
        auto_invest_enabled:
          type: boolean
        auto_invest_frequency:
          $ref: "#/components/schemas/AutoInvestFrequency"
        auto_invest_config:
          $ref: "#/components/schemas/AutoInvestConfig"
        next_auto_invest_date:
          type: string
          format: date-time
        next_compound_date:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        total_funded:
          type: number
        total_withdrawn:
          type: number
        total_returns:
          type: number
        available_returns:
          type: number
        maturity_date:
          type: string
          format: date-time
        plan_type:
          $ref: "#/components/schemas/PlanType"
        metadata:
          type: object
          properties:
            created_by:
              type: string
            goal_amount:
              type: number
            is_gifted:
              type: boolean
            type:
              type: string
            category:
              type: string
      required:
        - plan_name
        - owner_id
        - portfolio_config
        - status
        - duration
        - cycle
        - capital
        - investment
        - reinvest
        - auto_invest_enabled
        - auto_invest_frequency
        - auto_invest_config
        - next_auto_invest_date
        - next_compound_date
        - total_funded
        - total_withdrawn
        - total_returns
        - available_returns
        - maturity_date
        - plan_type

    SendGiftDTO:
      type: object
      required:
        - plan_name
        - portfolio_config
        - amount
        - duration
        - description
        - recipient_identifier
        - plan_type
      properties:
        plan_name:
          type: string
        portfolio_config:
          $ref: "#/components/schemas/PortfolioConfig"
        amount:
          type: number
          format: float
          minimum: 0
        duration:
          type: integer
          format: int32
          minimum: 1
        description:
          type: string
        recipient_identifier:
          type: string
        plan_type:
          $ref: "#/components/schemas/PlanType"

    Gift:
      type: object
      properties:
        id:
          type: string
          format: uuid
        owner_id:
          type: string
          format: uuid
        recipient_identifier:
          type: string
          format: uuid
        plan_name:
          type: string
        amount:
          type: number
        duration:
          type: integer
        description:
          type: string
        status:
          type: string
          enum: [pending, accepted, declined, cancelled]
        portfolio_config:
          $ref: "#/components/schemas/PortfolioConfig"
        plan_type:
          $ref: "#/components/schemas/PlanType"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        metadata:
          $ref: "#/components/schemas/GiftMetadata"

    PlanTransactionDTO:
      type: object
      required:
        - plan_id
        - owner_id
        - amount
        - type
      properties:
        plan_id:
          type: string
        owner_id:
          type: string
          format: uuid
        amount:
          type: number
        type:
          type: string
          enum: [funding, withdrawal]
        should_waive_charges:
          type: boolean
          default: false
        penalty_fee_percent:
          type: integer
          minimum: 1
          maximum: 99
        transaction_request_id:
          type: string
          format: uuid

    TwoFAActionDTO:
      type: object
      required:
        - auth_type
        - auth_credential
        - auth_action
      properties:
        auth_type:
          type: string
          enum: ["password", "pin"]
          default: pin
        auth_credential:
          type: string
          default: "123456"
        auth_action:
          type: string
          enum: ["gift-plan", "wallet-transfer", "bank-withdrawal"]

    UserAutoInvestConfigDTO:
      type: object
      required:
        - wallet_id
        - priority
        - wallet_type
        - scope
      properties:
        wallet_id:
          type: string
          format: uuid
        plan_id:
          type: string
          format: uuid
        priority:
          type: string
          enum: ["primary", "secondary"]
          default: "primary"
        wallet_type:
          type: string
          enum: ["external", "internal"]
          default: "internal"
        scope:
          type: string
          enum: ["global", "specific"]
          default: "global"

    TwoFAAction:
      type: object
      properties:
        otp:
          type: string

    HistoricalPerformance:
      type: object
      properties:
        year:
          type: number
        returns_percentage:
          type: number

    Composition:
      type: object
      properties:
        asset_class:
          type: string
        percentage:
          type: number

    ReinvestDTO:
      type: object
      properties:
        amount:
          type: number

    CustomPlans:
      type: array
      items:
        $ref: "#/components/schemas/CustomPlan"

    CustomPlan:
      type: object
      properties:
        name:
          type: string
        category:
          type: string
        plan_type:
          $ref: "#/components/schemas/PlanType"
        description:
          type: string
        landing_page_image:
          type: string
        plan_image:
          type: string
        is_live:
          type: boolean
        has_add_money_screen:
          type: boolean
        risk_level:
          type: string
        returns_range:
          type: string
        historical_performance:
          type: array
          items:
            $ref: "#/components/schemas/HistoricalPerformance"
        composition:
          type: object
          additionalProperties:
            $ref: "#/components/schemas/Composition"
          example:
            {
              "9d6d3d58-c799-4147-a71e-3e5f59e239ea":
                { asset_class: "etf", percentage: 100 },
            }

    TransactionRequest:
      type: object
      required:
        - id
        - plan_id
        - owner_id
        - request_type
        - status
        - currency
        - amount
      properties:
        id:
          type: string
        plan_id:
          type: string
        owner_id:
          type: string
        request_type:
          type: string
          enum:
            - funding
            - withdrawal
        status:
          type: string
          enum:
            - pending
            - successful
            - failed
            - canceled
            - processing
        currency:
          type: string
        amount:
          type: number
        metadata:
          $ref: "#/components/schemas/TransactionMetadata"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    TransactionMetadata:
      type: object
      properties:
        source:
          $ref: "#/components/schemas/TransactionSource"
        destination:
          $ref: "#/components/schemas/TransactionDestination"
        source_id:
          type: string
        destination_id:
          type: string
        portfolio_config:
          $ref: "#/components/schemas/PortfolioConfig"
        wallet_fund_transaction_id:
          type: string
          nullable: true
        fee_transaction_id:
          type: string
          nullable: true
        fee:
          type: number
          nullable: true
        app_version:
          type: string
          nullable: true
        description:
          type: string
          nullable: true
        initiated_by:
          type: string
          nullable: true
        is_payout:
          type: boolean
          nullable: true
        is_reinvested:
          type: boolean
          nullable: true

    GiftMetadata:
      type: object
      properties:
        sender_name:
          type: string
        sender_email:
          type: string
        recipient_name:
          type: string
        recipient_email:
          type: string

    DirectDebitDTO:
      type: object
      properties:
        wallet_type:
          type: string
          enum: [direct_debit]
        metadata:
          type: object
          properties:
            external_wallet_id:
              type: string
            address:
              type: object
              properties:
                house_number:
                  type: string
                street_name:
                  type: string
                city:
                  type: string

    ExternalWallet:
      type: object
      properties:
        id:
          type: string
          format: uuid
        owner_id:
          type: string
          format: uuid
        wallet_type:
          type: string
          enum: [direct_debit]
        created_at:
          type: string
          format: date-time
        status:
          type: string
          enum: [active, inactive]
        is_visible:
          type: boolean
          default: true
        details:
          type: object
          properties:
            currency:
              type: string
              enum: [ngn]
            state:
              type: string
              enum:
                [
                  "approved",
                  "debitable",
                  "rejected",
                  "created",
                  "paused",
                  "canceled",
                  "pending",
                ]
            provider:
              type: string
              enum: [mono]
            bank_name:
              type: string
            account_number:
              type: string
            account_name:
              type: string
            reference:
              type: string
              format: uuid
            customer_id:
              type: string
              format: uuid
            provider_reference:
              type: string
              format: uuid
            external_wallet_bank_account_id:
              type: string
              format: uuid
            provider_action:
              type: object
              properties:
                type:
                  type: string
                  enum: [transfer, redirect]
                  default: transfer
                action:
                  type: object
                  properties:
                    icon:
                      type: string
                    bank_name:
                      type: string
                    account_number:
                      type: string
                    fee:
                      type: number
                      default: 50

    ExternalWalletTransactionRequestDTO:
      type: object
      required:
        - request_type
        - currency
        - wallet_currency
        - amount
        - external_wallet_id
      properties:
        external_wallet_id:
          type: string
          format: uuid
        request_type:
          type: string
          enum:
            - funding
            - withdrawal
        currency:
          type: string
          enum:
            - ngn
        amount:
          type: number
        wallet_currency:
          type: string
          enum:
            - ngn
            - usd

    ExternalWalletTransactionRequestResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        status:
          type: string
          enum:
            - pending
            - successful
            - failed
            - canceled
            - processing
        currency:
          type: string
          enum:
            - ngn
        amount:
          type: number
        owner_id:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        transaction_id:
          type: string
          format: uuid
        request_type:
          type: string
          enum:
            - funding
            - withdrawal
        provider:
          type: string
          enum: [mono]
        local_amount:
          type: number
        local_currency:
          type: string
          enum: [ngn]
        external_wallet_id:
          type: string
          format: uuid
        fee:
          type: number
        provider_metadata:
          type: object
        screening:
          type: object

    TransactionSource:
      type: string
      enum:
        - crypto_wallet
        - account
        - virtual_account
        - bank_account
        - mobile_money
        - card
        - virtual_card
        - api_vendor
        - plan
        - wallet
        - portfolio
        - revenue
        - system
        - commission
        - gift
        - returns
    TransactionDestination:
      type: string
      enum:
        - crypto_wallet
        - account
        - virtual_account
        - bank_account
        - mobile_money
        - card
        - virtual_card
        - api_vendor
        - plan
        - wallet
        - portfolio
        - revenue
        - system
        - commission
        - gift
        - returns

    AUMStats:
      type: object
      properties:
        total_returns:
          type: number
          description: Total returns across plans.
        percentage_change:
          type: number
          description: The percentage change in portfolio value.
        total_returns_percent:
          type: number
          description: Total returns as a percentage.
        investment_balance:
          type: number
          description: The current investment balance.
        portfolio_distribution:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/AssetMix'
          example:
            {
              "9d6d3d58-c799-4147-a71e-3e5f59e239ea": { asset_class: "bond", value: 236.18 },
              "9e6d3d58-c799-4147-a71e-3e5f59e239ea": { asset_class: "etf", value: 633.85 },
              "9f6d3d58-c799-4147-a71e-3e5f59e239ea": { asset_class: "real-estate", value: 189.01 }
            }
          description: A record of asset classes and their corresponding mix.

    AssetMix:
      type: object
      properties:
        asset_class:
          type: string
        value:
          type: number
          description: The monetary value of this asset.

    PropertyInfo:
      type: object
      properties:
        property_type:
          type: string
          description: The type of property (e.g., house, apartment).
        build_year:
          type: string
          description: The year the property was built.
        size:
          type: number
          description: The size of the property in square units.
        beds:
          type: number
          description: Number of bedrooms in the property.
        baths:
          type: number
          description: Number of bathrooms in the property.
        address:
          type: string
          description: The property's address.
        city:
          type: string
          description: The city where the property is located.
        income:
          type: number
          description: The income generated by the property.

    AssetInfo:
      type: object
      properties:
        image:
          type: string
          description: URL to an image representing the asset.
        description:
          type: string
          description: A brief description of the asset.
        ticker:
          type: string
          nullable: true
          description: The stock ticker symbol, if applicable.
        property_info:
          $ref: "#/components/schemas/PropertyInfo"
          description: Information about a property, if applicable.

    Asset:
      type: object
      properties:
        type:
          type: string
          description: The type of asset.
        asset_class:
          $ref: "#/components/schemas/AssetClass"
          description: The asset class (e.g., etf, real-estate, bond).
        cost_price:
          type: number
          description: The cost price of the asset.
        previous_price:
          type: number
          description: The previous price of the asset.
        current_price:
          type: number
          description: The current price of the asset.
        info:
          $ref: "#/components/schemas/AssetInfo"
          description: Additional information about the asset.


    RegisterationDTO:
      type: object
      required:
        - email_address
        - password
        - phone_number
        - address_metadata
        - country
        - country_of_residence
      properties:
        email_address:
          type: string
          format: email
        password:
          type: string
          format: password
        phone_number:
          type: string
        address_metadata:
          $ref: '#/components/schemas/AddressMetadata'
        country:
          type: string
        country_of_residence:
          type: string
        first_name:
          type: string
        last_name:
          type: string
        profile_picture:
          type: string
          format: uri
        date_of_birth:
          type: string
          format: date
        referral_code:
          type: string
        referral_id:
          type: string
              
        AddressMetadata:
          type: object
          required:
            - street_address
            - city
            - state
            - zip_code
          properties:
            street_address:
              type: string
              description: street address of a user
            city:
              type: string
              description: city of that address
            state:
              type: string
              description: state the city is in
            zip_code:
              type: string
              description: zipcode of user's area

        Session:
          type: object
          required:
            - id
            - user_id
            - first_name
            - last_name
            - email_address
            - location
            - account_id
            - account_type
            - platform
            - platform-os
            - current_app_version
          properties:
            id:
              type: string
              description: a random uuid for the session
            user_id:
              type: string
              description: the user's id
            first_name:
              type: string
              description: first name of the user
            last_name:
              type: string
              description: last name of the user
            email_address:
              type: string
              format: email
              description: email of the user
            location:
              type: string
              description: where the user signed in from
            account_id:
              type: string
              description: account the user is signed into
            account_type:
              type: string
              description: type of account the user is signed in to
            platform:
              oneOf:
                - type: string
                - type: array
                  items:
                    type: string
              description: platform the user signed in from
            platform-os:
              oneOf:
                - type: string
                - type: array
                  items:
                    type: string
              description: platform os the user signed in from
            current_app_version:
              type: string
              description: current app version

      RegistrationResponse:
        type: object
        properties:
          token:
            type: string
            description: authentication token returned after registration
          session:
            $ref: '#/components/schemas/Session'

      ValidateSignupDTO:
        type: object
        required:
          - identity_type
          - identifier
        properties:
          identity_type:
            type: string
            enum:
              - email
              - phone
            description: The type of identity provided (e.g., email, phone, etc.)
          identifier:
            type: string
            description: The identifier value to be validated


  securitySchemes:
    headlessAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Authentication for headless operations